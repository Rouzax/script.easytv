EasyTV Changelog
================

v1.2.1 (2026-01-22)
-------------------
New Features:
  - Two new smart playlists for premiere episodes:
    - "EasyTV - Show Premieres" — Shows at S01E01 (brand new shows to start)
    - "EasyTV - Season Premieres" — Shows at S02E01+ (new seasons of existing shows)
  - Smart playlists now work with Jellyfin and other plugin-based libraries
    - Plugin URLs (plugin://...) are now preserved in playlist rules
    - Previously only local file paths worked correctly

Bug Fixes:
  - Fixed smart playlists breaking with special characters in filenames
    - Characters like & < > are now properly XML-escaped
    - Example: "Pam & Tommy" now works correctly
  - Fixed potential XML parsing issues with show names containing "--"
    - Playlist entries now use numeric show IDs instead of show names as markers

Internal:
  - Smart playlist format versioning for safe upgrades
    - Playlists automatically regenerate when format changes
    - Version tracked in: special://profile/addon_data/script.easytv/playlist_format.json
  - Removed unused 'showname' field from internal playlist data structures

v1.2.0 (2026-01-21)
-------------------
New Features:
  - Episode duration filter: Filter shows by typical episode length
    - Enable filter and set min/max duration in minutes (0-120, step 5)
    - Works in both Browse Mode and Random Playlist mode
    - Duration calculated as median from episode file metadata
    - Shows without duration data are excluded when filter is active
    - Set filter to "All" to include shows with unknown duration
    - Warning shown if min > max (filter disabled, all shows included)
  - Both mode now uses dynamic playlist building ("lazy queue")
    - Playlist starts with 2-3 items visible instead of full length
    - Additional items are added automatically as you watch
    - On-deck episodes now progress naturally when same show appears multiple times
      (S02E05 → S02E06 → S02E07 as each episode is watched)
    - Unwatched/Watched modes unchanged (still build full playlist upfront)
    - Requires "Allow multiple episodes of same TV Show" to be enabled
  - Fixed LANGUAGE_ARTICLES for proper alphabetical sorting:
    - Removed languages without articles (Russian, Polish, Turkish)
    - Added indefinite articles (a/an) for English and other languages
    - Added missing languages: Italian, Portuguese, Norwegian, Catalan, Romanian, Greek
    - Example: "A Man in Full" now sorts under M, not A

Bug Fixes:
  - Fixed library scan not triggering EasyTV refresh
    - New shows/episodes now appear after library scan completes
    - Added onScanFinished handler (was missing)
  - Fixed Poster/BigScreen views showing only numbers without labels
    - Added missing language strings (32220-32226) for skin labels
    - Labels like "Season", "Episode", "Unwatched", etc. now display correctly
    - Affects both main addon and clones
  - Fixed show selector sorting issues ("Pick shows manually", "Random order shows")
    - Now case-insensitive ("black-ish" sorts with B's, not after Z)
    - Now handles articles ("A Man in Full" sorts under M, not A)
    - Uses same sorting logic as Browse mode for consistency
  - Fixed show selector missing artwork (showed placeholder icons)
    - Now uses modern art.poster property instead of legacy thumbnail
  - Fixed clone Browse mode showing "EasyTV" instead of clone name in title
  - Fixed clone skin XML files not updated during clone creation/update
    - Skin XML files now updated to use clone addon ID for language strings
  - Clone update script now applies all fixes (was missing several updates)
    - Existing clones can be updated via the update mechanism to get these fixes
  - Fixed random playlist picking same show repeatedly when "Allow multiple episodes" enabled
    - Shows are now properly distributed throughout the playlist
    - After adding an episode, show moves to end of candidate list

Performance:
  - Duration cache optimization: Significantly reduced startup time
    - Median episode durations are now cached to disk
    - Streamdetails only queried for shows with changed episode counts
    - First startup: one-time full calculation
    - Subsequent startups: ~81% faster on OSMC Vero V (32s → 6s)
    - Cache file: special://profile/addon_data/script.easytv/duration_cache.json
    - Cache now includes show titles for easier debugging
  - Removed redundant full refresh on every database update
    - Watch state changes now handled surgically via notifications
    - Full refresh only triggers on library scan completion
  - Art now lazy-loaded when Browse mode opens (~1s one-time cost per session)
    - Reduces data fetched during startup

Default Settings Changed:
  - "Include series premieres" now enabled by default (was disabled)
  - "Playlist content" now defaults to "TV episodes only" (was "TV and movies")
  - "Ask to watch next episode" now disabled by default (was enabled)
  - "Prompt timeout" now defaults to 5 seconds (was 20)
  - "Warn about earlier unwatched episodes" now enabled by default (was disabled)

Internal:
  - Added timing instrumentation for performance monitoring (DEBUG level)
  - Removed unused episode thumbnail (Art(thumb)) caching
  - New module: resources/lib/data/duration_cache.py
  - Reorganized strings.po with documented ID ranges for maintainability:
    - 32000-32099: UI Elements (sort options, view styles, spinner values)
    - 32100-32199: Dialogs and Messages
    - 32200-32299: Context Menu and Skin Labels
    - 32300-32399: Addon Metadata
    - 32400-32499: Help Text
    - 32500-32599: Settings UI (labels, categories, groups)
    - 32600-32699: Feature-Specific Strings
  - Removed legacy comments and empty string placeholders from strings.po
  - Moved misplaced string IDs: 32032→32522, 32037→32523

v1.1.1 (2026-01-20)
-------------------
Bug Fixes:
  - Fixed clone settings showing blank labels (no text visible)
    - Clone settings.xml section ID now matches clone addon ID
    - Clone strings.po header now matches clone addon ID
    - Clone now built in temp folder before moving to addons (helps with caching)
  - Fixed clone missing v1.1.0 settings (season premieres, unwatched ratio, 
    movie playlist filter, playlist continuation, random order shows)
  - Fixed clone version now inherits parent version (was always 1.0.0)
  - Fixed clone default settings now match parent defaults
  - Clone startup logs now include addon_id for identification
  - Clone naming keyboard now pre-fills with "EasyTV - " prefix
  - Added safeguards to prevent overwriting existing addons during clone creation

Performance Improvements:
  - Partial prioritization 99% faster (14.6s → 0.2s on test library)
    - TV partial episode query: 14,200ms → 94ms (99.3% faster)
    - Movie partial query: 427ms → 109ms (74% faster)
  - Total random playlist build time reduced from ~18s to ~4s (78% faster)
  - Uses Kodi's native 'inprogress' filter instead of per-show queries
  - Test environment: OSMC Vero V with 168 shows, 5646 episodes, 846 movies

Improvements:
  - Enhanced action logging at INFO level:
    - Random playlist: logs content type, target length, show/movie counts
    - Browse mode: logs start/stop with show count
  - Clone creation now updates ALL language files (future Weblate support)
  - Added timing instrumentation for partial prioritization queries

Known Issues:
  - On Windows, clone uninstall may fail due to file locking. Workaround:
    restart Kodi after uninstalling a clone before creating a new one with
    the same name.
  - Clone settings labels require Kodi restart to appear (Kodi caches
    language strings at startup - this is a Kodi limitation).

v1.1.0 (2026-01-19)
-------------------
New Features:
  - Episode selection: Choose which TV episodes to include in random playlists
    - Unwatched only (default - matches original behavior)
    - Watched only (re-watch your favorites)
    - Both (true channel surfing with any episode)
  - Movie playlist filtering: Limit which movies appear in random playlists
    - Use any Kodi smart playlist to filter movies by genre, year, rating, etc.
    - Works with both "TV and movies" and "Movies only" content modes
  - Season premieres setting: Control season premiere episodes (S02E01, S03E01, etc.)
    independently from series premieres (S01E01)
  - Playlist continuation: Option to prompt when a random playlist ends
    - Configurable countdown timer (0-60 seconds)
    - Generate another playlist with same settings or stop
  - Playlist picker now filters by type (TV playlists for TV filter, movie 
    playlists for movie filter)
  - Default launch option changed to "Ask me" for new installs
  - Separate partial/resume settings for TV and Movies:
    - "Start playlist with unfinished episodes" - prioritize partial TV episodes
    - "Start playlist with unfinished movies" - prioritize partial movies
    - "Seek to resume point for episodes" - auto-resume TV episodes
    - "Seek to resume point for movies" - auto-resume movies
  - Enhanced partial prioritization:
    - ALL partial items now moved to front of playlist (not just one)
    - Partials sorted by recency (most recently watched first)
    - Episodes from the same show maintain episode order

Performance Improvements:
  - Startup time reduced from ~11 seconds to <1 second for large libraries
  - Replaced per-show episode queries with single bulk query
  - Batched smart playlist writes: 831 file operations reduced to 3
  - Server-side random sorting reduces data transfer and processing time

Bug Fixes:
  - Fixed "Both" mode episode selection when same show appears multiple times
    - On-deck (next unwatched) episode now appears at most once per show
    - Watched episodes no longer duplicate within a single playlist
    - Playlist gracefully shortens when episodes are exhausted
  - Fixed partial episode resume reliability
    - Uses Kodi's actual resume data instead of stale window property flags
    - Respects Kodi's advancedsettings.xml resume thresholds
    - Deferred seek to onAVStarted when player is ready
    - Uses absolute time for precise 10-second rewind
  - Fixed repeated show selection when stopping/starting playlists quickly

Settings Reorganization:
  - "Episode List" category renamed to "Browse Mode" for clarity
  - "TV Options" and "Movie Options" merged into "Content Options"
  - Standardized terminology: "Shuffle-Friendly" → "Random-Order" throughout
  - New "Playlist Continuation" group in Random Playlist settings
  - Partial/resume settings split into TV and Movie variants (see Breaking Changes)

Breaking Changes:
  - Partial/resume settings replaced with separate TV and movie variants:
    - "start_partials" → "start_partials_tv" + "start_partials_movies"
    - "resume_partials" → "resume_partials_tv" + "resume_partials_movies"
  - All partial settings now default to enabled (previously disabled)
    - Existing users may want to disable if they preferred the old defaults

Developer/Debugging:
  - Added logging for Kodi's resume point thresholds at startup
  - Enhanced log_timing utility with phase breakdown support
  - Detailed timing instrumentation for performance monitoring
  - Added playlist.continuation and playlist.regenerate events

v1.0.1 (2026-01-16)
-------------------
- Updated addon icon

v1.0.0 (2026-01-16)
-------------------
Initial release as EasyTV - a fork and complete rewrite of LazyTV by KODeKarnage.

What is EasyTV?
  No scrolling. No deciding. Just watching.
  EasyTV tracks your TV shows and always knows your next episode. When you're 
  ready for something new, it suggests a show you haven't started. Mix in movies
  if you want. Just sit down, press play, and enjoy.

Major Changes from LazyTV:
  - Complete rewrite for Kodi 21+ (Python 3.8+)
  - Modernized settings system (Kodi 19+ format)
  - Modular architecture for better maintainability
  - Improved logging system with separate debug log file
  - Enhanced error handling throughout

Features:
  - Episode List Mode: Browse next unwatched episodes for all your shows
  - Random Playlist Mode: Channel-surf through episodes (and optionally movies)
  - Smart Playlists: Auto-maintained playlists for use with other addons/skins
    - EasyTV - All Shows
    - EasyTV - Continue Watching  
    - EasyTV - Start Fresh
  - Random Order Shows: Designate shows to play episodes in any order
  - Next Episode Prompts: Get notified when an episode ends
  - Previous Episode Check: Warning if you're about to skip episodes
  - Clone Support: Create multiple configurations for your home screen
  - Episode Export: Copy episodes to external storage

Credits:
  Original LazyTV created by KODeKarnage (2013)
  https://github.com/KODeKarnage/script.lazytv

  Modernized and maintained by Rouzax (2024-2026)
  https://github.com/Rouzax/script.easytv

License:
  GPL-3.0-or-later
